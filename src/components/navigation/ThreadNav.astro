---
// assets
import '@styles/tokens/borders.css';
import '@styles/tokens/color.css';
import '@styles/tokens/spacing.css';
import '@styles/tokens/type.css';
import '@styles/utilities/type.css';

// components
import Dot from '@components/elements/Dot.astro';
import Tooltip from '@components/elements/Tooltip.astro';
import Heading from '@components/blocks/Heading.astro';

// types
export interface Props {
	title?: string;
	class?: string;
	currentNumber?: number;
	description?: string;
}

const {
	title,
	class: className = '',
	description,
} = Astro.props as Props;
---

<aside class={className}>
	<Heading level={2} class="type-scale-epsilon">
		This post is part of a thread.
		<Dot class="help">
			?
			<Tooltip
				class="tooltip"
				id="thread-tooltip"
			>
				A thread is a series of posts that explore a theme.
			</Tooltip>
		</Dot>
	</Heading>
	{(title || description) && (
		<div class="info">
			{title && <Heading level={3} class="type-scale-delta">{title}</Heading>}
			{description && <p class="type-role-accent type-scale-zeta">{description}</p>}
		</div>
	)}
	<details>
		<summary class="type-role-accent type-scale-zeta">
			<span class="icon">Posts in this thread</span>
		</summary>
		<ol role="list">
			<slot></slot>
		</ol>
	</details>
</aside>

<script>
	let Tooltip = {
		selector: '.help',
		openClass: 'open',
		$button: null,
	};

	Tooltip.$button = document.querySelector(Tooltip.selector);

	document.addEventListener('click', (event) => {
		if (event.target.closest('.help')) {
			Tooltip.$button.classList.toggle(Tooltip.openClass);
			return;
		}
		Tooltip.$button.classList.remove(Tooltip.openClass);
	});
</script>

<style>
	aside {
		background-color: var(--color-well);
		border-radius: var(--border-radius);
		padding: var(--space-narrow);
		text-align: left;
	}

	/* only show the help tooltip if JS is available */
	:global(.no-js) .help {
		display: none;
	}

	/* increase specificity so it overrides the child component */
	aside .help {
		--size: 2em;
		--color: var(--color-secondary);

		margin-inline-start: 0.25em;
		margin-block-start: calc((var(--size) / 4) * -1); /* scootch up a little */
	}

	aside .help.open {
		--color: var(--color-highlight);
	}

	aside .tooltip {
		--max-width: 24rem;
		--min-width: 16rem;
	}

	.help.open .tooltip {
		--show: 1;
	}

	.info {
		border-block-start: var(--border-default);
		margin-block-start: var(--space-xnarrow);
		padding-block-start: var(--space-xnarrow);
	}

	.info > :global(* + *) {
		padding-block-start: var(--space-xxnarrow);
	}

	details {
		border-block-start: var(--border-default);
		margin-block-start: var(--space-narrow);
		padding-block-start: var(--space-xnarrow);
	}

	summary {
		cursor: pointer;
		display: block;
	}

	summary::marker,
	summary::-webkit-details-marker {
		display: none;
	}

	summary:hover,
	summary:active,
	[open] summary {
		color: var(--color-highlight);
	}

	.icon {
		position: relative;
		display: flex;
		align-items: center;
	}

	.icon::before {
		--icon-size: 1.2rem;

		background-color: var(--color-primary);
		content: '';
		display: inline-block;
		height: var(--icon-size);
		margin-inline-end: var(--space-xnarrow);
		mask: url('/assets/icons/expand.svg') center no-repeat;
		mask-size: contain;
		position: relative;
		width: var(--icon-size);
	}

	[open] .icon::before {
		mask-image: url('/assets/icons/collapse.svg');
	}

	summary:hover .icon::before,
	summary:active .icon::before,
	[open] .icon::before {
		background-color: var(--color-highlight);
	}

	ol {
		list-style: none;
		margin-block: 0;
		padding-block-start: var(--space-medium);
		padding-inline-start: 0;
		position: relative;
	}
</style>
