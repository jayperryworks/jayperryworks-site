---
// styles
import '@styles/tokens/spacing.css';
import '@styles/tokens/contentWidth.css';

// child components
import Image from '@components/elements/Image.astro';
import DeviceFrame from '@components/elements/DeviceFrame.astro';
import PictureFrame from '@components/elements/PictureFrame.astro';
import Caption from '@components/blocks/FigureCaption.astro';
import RevealOnScroll from '@components/layout/RevealOnScroll.astro';

// typescript
import type { ImageField } from '@prismicio/types';

import type {
	Device,
	FormattedText,
	ImageFit,
} from '@lib/types';

export interface Props {
	source: ImageField;
	attribution?: FormattedText;
	border?: boolean;
	caption?: FormattedText;
	frame?: Device;
	fit?: ImageFit;
	class?: string;
}

// props
const {
	source,
	attribution,
	border,
	caption,
	frame = 'None',
	class: className,
	fit,
} = Astro.props as Props;

const frameComponents = {
	'None': {
		component: Image,
		props: {
			border,
			fit,
			source,
		},
	},
	'Matte': {
		component: PictureFrame,
		props: {
			type: 'matte',
			source,
		},
	},
	'Frame & matte': {
		component: PictureFrame,
		props: {
			type: 'frame',
			source,
		},
	},
	'Panel': {
		component: PictureFrame,
		props: {
			type: 'panel',
			source,
		},
	},
	'Phone': {
		component: DeviceFrame,
		props: {
			type: 'Phone',
			source,
		},
	},
'Tablet (horizontal)': {
		component: DeviceFrame,
		props: {
			type: 'Tablet (horizontal)',
			source,
		},
	},
'Tablet (portrait)': {
		component: DeviceFrame,
		props: {
			type: 'Tablet (portrait)',
			source,
		},
	},
};

const {
	component: FrameComponent,
	props,
} = frameComponents[frame];
---

<figure class={['figure', className].join(' ')}>
	<RevealOnScroll>
		<slot>
			{source && (
				<FrameComponent {...props} />
			)}
		</slot>

		{(caption || attribution) && (
			<Caption
				class="caption"
				text={caption}
				{attribution}
			/>
		)}
	</RevealOnScroll>
</figure>

<style>
	.figure {
		text-align: center;
	}

	.figure :global(img) {
		width: 100%;
	}

	.figure :global(.caption) {
		margin-block-start: auto;
		margin-inline: auto;
		padding-block-start: var(--space-narrow);
		max-width: var(--content-width-default);
	}
</style>
